{"ast":null,"code":"import { determineTimestampFormat } from \"@smithy/core/protocols\";\nimport { NormalizedSchema } from \"@smithy/core/schema\";\nimport { dateToUtcString, generateIdempotencyToken, LazyJsonString, NumericValue } from \"@smithy/core/serde\";\nimport { toBase64 } from \"@smithy/util-base64\";\nimport { SerdeContextConfig } from \"../ConfigurableSerdeContext\";\nimport { JsonReplacer } from \"./jsonReplacer\";\nexport class JsonShapeSerializer extends SerdeContextConfig {\n  settings;\n  buffer;\n  rootSchema;\n  constructor(settings) {\n    super();\n    this.settings = settings;\n  }\n  write(schema, value) {\n    this.rootSchema = NormalizedSchema.of(schema);\n    this.buffer = this._write(this.rootSchema, value);\n  }\n  writeDiscriminatedDocument(schema, value) {\n    this.write(schema, value);\n    if (typeof this.buffer === \"object\") {\n      this.buffer.__type = NormalizedSchema.of(schema).getName(true);\n    }\n  }\n  flush() {\n    const {\n      rootSchema\n    } = this;\n    this.rootSchema = undefined;\n    if (rootSchema?.isStructSchema() || rootSchema?.isDocumentSchema()) {\n      const replacer = new JsonReplacer();\n      return replacer.replaceInJson(JSON.stringify(this.buffer, replacer.createReplacer(), 0));\n    }\n    return this.buffer;\n  }\n  _write(schema, value, container) {\n    const isObject = value !== null && typeof value === \"object\";\n    const ns = NormalizedSchema.of(schema);\n    if (ns.isListSchema() && Array.isArray(value)) {\n      const listMember = ns.getValueSchema();\n      const out = [];\n      const sparse = !!ns.getMergedTraits().sparse;\n      for (const item of value) {\n        if (sparse || item != null) {\n          out.push(this._write(listMember, item));\n        }\n      }\n      return out;\n    } else if (ns.isMapSchema() && isObject) {\n      const mapMember = ns.getValueSchema();\n      const out = {};\n      const sparse = !!ns.getMergedTraits().sparse;\n      for (const [_k, _v] of Object.entries(value)) {\n        if (sparse || _v != null) {\n          out[_k] = this._write(mapMember, _v);\n        }\n      }\n      return out;\n    } else if (ns.isStructSchema() && isObject) {\n      const out = {};\n      for (const [memberName, memberSchema] of ns.structIterator()) {\n        const targetKey = this.settings.jsonName ? memberSchema.getMergedTraits().jsonName ?? memberName : memberName;\n        const serializableValue = this._write(memberSchema, value[memberName], ns);\n        if (serializableValue !== undefined) {\n          out[targetKey] = serializableValue;\n        }\n      }\n      return out;\n    }\n    if (value === null && container?.isStructSchema()) {\n      return void 0;\n    }\n    if (ns.isBlobSchema() && (value instanceof Uint8Array || typeof value === \"string\") || ns.isDocumentSchema() && value instanceof Uint8Array) {\n      if (ns === this.rootSchema) {\n        return value;\n      }\n      return (this.serdeContext?.base64Encoder ?? toBase64)(value);\n    }\n    if ((ns.isTimestampSchema() || ns.isDocumentSchema()) && value instanceof Date) {\n      const format = determineTimestampFormat(ns, this.settings);\n      switch (format) {\n        case 5:\n          return value.toISOString().replace(\".000Z\", \"Z\");\n        case 6:\n          return dateToUtcString(value);\n        case 7:\n          return value.getTime() / 1000;\n        default:\n          console.warn(\"Missing timestamp format, using epoch seconds\", value);\n          return value.getTime() / 1000;\n      }\n    }\n    if (ns.isNumericSchema() && typeof value === \"number\") {\n      if (Math.abs(value) === Infinity || isNaN(value)) {\n        return String(value);\n      }\n    }\n    if (ns.isStringSchema()) {\n      if (typeof value === \"undefined\" && ns.isIdempotencyToken()) {\n        return generateIdempotencyToken();\n      }\n      const mediaType = ns.getMergedTraits().mediaType;\n      if (value != null && mediaType) {\n        const isJson = mediaType === \"application/json\" || mediaType.endsWith(\"+json\");\n        if (isJson) {\n          return LazyJsonString.from(value);\n        }\n      }\n    }\n    if (ns.isDocumentSchema()) {\n      if (isObject) {\n        const out = Array.isArray(value) ? [] : {};\n        for (const [k, v] of Object.entries(value)) {\n          if (v instanceof NumericValue) {\n            out[k] = v;\n          } else {\n            out[k] = this._write(ns, v);\n          }\n        }\n        return out;\n      } else {\n        return structuredClone(value);\n      }\n    }\n    return value;\n  }\n}","map":{"version":3,"names":["determineTimestampFormat","NormalizedSchema","dateToUtcString","generateIdempotencyToken","LazyJsonString","NumericValue","toBase64","SerdeContextConfig","JsonReplacer","JsonShapeSerializer","settings","buffer","rootSchema","constructor","write","schema","value","of","_write","writeDiscriminatedDocument","__type","getName","flush","undefined","isStructSchema","isDocumentSchema","replacer","replaceInJson","JSON","stringify","createReplacer","container","isObject","ns","isListSchema","Array","isArray","listMember","getValueSchema","out","sparse","getMergedTraits","item","push","isMapSchema","mapMember","_k","_v","Object","entries","memberName","memberSchema","structIterator","targetKey","jsonName","serializableValue","isBlobSchema","Uint8Array","serdeContext","base64Encoder","isTimestampSchema","Date","format","toISOString","replace","getTime","console","warn","isNumericSchema","Math","abs","Infinity","isNaN","String","isStringSchema","isIdempotencyToken","mediaType","isJson","endsWith","from","k","v","structuredClone"],"sources":["d:/ITechArt/react-lab-2025/application/node_modules/@aws-sdk/middleware-sdk-s3/node_modules/@aws-sdk/core/dist-es/submodules/protocols/json/JsonShapeSerializer.js"],"sourcesContent":["import { determineTimestampFormat } from \"@smithy/core/protocols\";\nimport { NormalizedSchema } from \"@smithy/core/schema\";\nimport { dateToUtcString, generateIdempotencyToken, LazyJsonString, NumericValue } from \"@smithy/core/serde\";\nimport { toBase64 } from \"@smithy/util-base64\";\nimport { SerdeContextConfig } from \"../ConfigurableSerdeContext\";\nimport { JsonReplacer } from \"./jsonReplacer\";\nexport class JsonShapeSerializer extends SerdeContextConfig {\n    settings;\n    buffer;\n    rootSchema;\n    constructor(settings) {\n        super();\n        this.settings = settings;\n    }\n    write(schema, value) {\n        this.rootSchema = NormalizedSchema.of(schema);\n        this.buffer = this._write(this.rootSchema, value);\n    }\n    writeDiscriminatedDocument(schema, value) {\n        this.write(schema, value);\n        if (typeof this.buffer === \"object\") {\n            this.buffer.__type = NormalizedSchema.of(schema).getName(true);\n        }\n    }\n    flush() {\n        const { rootSchema } = this;\n        this.rootSchema = undefined;\n        if (rootSchema?.isStructSchema() || rootSchema?.isDocumentSchema()) {\n            const replacer = new JsonReplacer();\n            return replacer.replaceInJson(JSON.stringify(this.buffer, replacer.createReplacer(), 0));\n        }\n        return this.buffer;\n    }\n    _write(schema, value, container) {\n        const isObject = value !== null && typeof value === \"object\";\n        const ns = NormalizedSchema.of(schema);\n        if (ns.isListSchema() && Array.isArray(value)) {\n            const listMember = ns.getValueSchema();\n            const out = [];\n            const sparse = !!ns.getMergedTraits().sparse;\n            for (const item of value) {\n                if (sparse || item != null) {\n                    out.push(this._write(listMember, item));\n                }\n            }\n            return out;\n        }\n        else if (ns.isMapSchema() && isObject) {\n            const mapMember = ns.getValueSchema();\n            const out = {};\n            const sparse = !!ns.getMergedTraits().sparse;\n            for (const [_k, _v] of Object.entries(value)) {\n                if (sparse || _v != null) {\n                    out[_k] = this._write(mapMember, _v);\n                }\n            }\n            return out;\n        }\n        else if (ns.isStructSchema() && isObject) {\n            const out = {};\n            for (const [memberName, memberSchema] of ns.structIterator()) {\n                const targetKey = this.settings.jsonName ? memberSchema.getMergedTraits().jsonName ?? memberName : memberName;\n                const serializableValue = this._write(memberSchema, value[memberName], ns);\n                if (serializableValue !== undefined) {\n                    out[targetKey] = serializableValue;\n                }\n            }\n            return out;\n        }\n        if (value === null && container?.isStructSchema()) {\n            return void 0;\n        }\n        if ((ns.isBlobSchema() && (value instanceof Uint8Array || typeof value === \"string\")) ||\n            (ns.isDocumentSchema() && value instanceof Uint8Array)) {\n            if (ns === this.rootSchema) {\n                return value;\n            }\n            return (this.serdeContext?.base64Encoder ?? toBase64)(value);\n        }\n        if ((ns.isTimestampSchema() || ns.isDocumentSchema()) && value instanceof Date) {\n            const format = determineTimestampFormat(ns, this.settings);\n            switch (format) {\n                case 5:\n                    return value.toISOString().replace(\".000Z\", \"Z\");\n                case 6:\n                    return dateToUtcString(value);\n                case 7:\n                    return value.getTime() / 1000;\n                default:\n                    console.warn(\"Missing timestamp format, using epoch seconds\", value);\n                    return value.getTime() / 1000;\n            }\n        }\n        if (ns.isNumericSchema() && typeof value === \"number\") {\n            if (Math.abs(value) === Infinity || isNaN(value)) {\n                return String(value);\n            }\n        }\n        if (ns.isStringSchema()) {\n            if (typeof value === \"undefined\" && ns.isIdempotencyToken()) {\n                return generateIdempotencyToken();\n            }\n            const mediaType = ns.getMergedTraits().mediaType;\n            if (value != null && mediaType) {\n                const isJson = mediaType === \"application/json\" || mediaType.endsWith(\"+json\");\n                if (isJson) {\n                    return LazyJsonString.from(value);\n                }\n            }\n        }\n        if (ns.isDocumentSchema()) {\n            if (isObject) {\n                const out = Array.isArray(value) ? [] : {};\n                for (const [k, v] of Object.entries(value)) {\n                    if (v instanceof NumericValue) {\n                        out[k] = v;\n                    }\n                    else {\n                        out[k] = this._write(ns, v);\n                    }\n                }\n                return out;\n            }\n            else {\n                return structuredClone(value);\n            }\n        }\n        return value;\n    }\n}\n"],"mappings":"AAAA,SAASA,wBAAwB,QAAQ,wBAAwB;AACjE,SAASC,gBAAgB,QAAQ,qBAAqB;AACtD,SAASC,eAAe,EAAEC,wBAAwB,EAAEC,cAAc,EAAEC,YAAY,QAAQ,oBAAoB;AAC5G,SAASC,QAAQ,QAAQ,qBAAqB;AAC9C,SAASC,kBAAkB,QAAQ,6BAA6B;AAChE,SAASC,YAAY,QAAQ,gBAAgB;AAC7C,OAAO,MAAMC,mBAAmB,SAASF,kBAAkB,CAAC;EACxDG,QAAQ;EACRC,MAAM;EACNC,UAAU;EACVC,WAAWA,CAACH,QAAQ,EAAE;IAClB,KAAK,CAAC,CAAC;IACP,IAAI,CAACA,QAAQ,GAAGA,QAAQ;EAC5B;EACAI,KAAKA,CAACC,MAAM,EAAEC,KAAK,EAAE;IACjB,IAAI,CAACJ,UAAU,GAAGX,gBAAgB,CAACgB,EAAE,CAACF,MAAM,CAAC;IAC7C,IAAI,CAACJ,MAAM,GAAG,IAAI,CAACO,MAAM,CAAC,IAAI,CAACN,UAAU,EAAEI,KAAK,CAAC;EACrD;EACAG,0BAA0BA,CAACJ,MAAM,EAAEC,KAAK,EAAE;IACtC,IAAI,CAACF,KAAK,CAACC,MAAM,EAAEC,KAAK,CAAC;IACzB,IAAI,OAAO,IAAI,CAACL,MAAM,KAAK,QAAQ,EAAE;MACjC,IAAI,CAACA,MAAM,CAACS,MAAM,GAAGnB,gBAAgB,CAACgB,EAAE,CAACF,MAAM,CAAC,CAACM,OAAO,CAAC,IAAI,CAAC;IAClE;EACJ;EACAC,KAAKA,CAAA,EAAG;IACJ,MAAM;MAAEV;IAAW,CAAC,GAAG,IAAI;IAC3B,IAAI,CAACA,UAAU,GAAGW,SAAS;IAC3B,IAAIX,UAAU,EAAEY,cAAc,CAAC,CAAC,IAAIZ,UAAU,EAAEa,gBAAgB,CAAC,CAAC,EAAE;MAChE,MAAMC,QAAQ,GAAG,IAAIlB,YAAY,CAAC,CAAC;MACnC,OAAOkB,QAAQ,CAACC,aAAa,CAACC,IAAI,CAACC,SAAS,CAAC,IAAI,CAAClB,MAAM,EAAEe,QAAQ,CAACI,cAAc,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IAC5F;IACA,OAAO,IAAI,CAACnB,MAAM;EACtB;EACAO,MAAMA,CAACH,MAAM,EAAEC,KAAK,EAAEe,SAAS,EAAE;IAC7B,MAAMC,QAAQ,GAAGhB,KAAK,KAAK,IAAI,IAAI,OAAOA,KAAK,KAAK,QAAQ;IAC5D,MAAMiB,EAAE,GAAGhC,gBAAgB,CAACgB,EAAE,CAACF,MAAM,CAAC;IACtC,IAAIkB,EAAE,CAACC,YAAY,CAAC,CAAC,IAAIC,KAAK,CAACC,OAAO,CAACpB,KAAK,CAAC,EAAE;MAC3C,MAAMqB,UAAU,GAAGJ,EAAE,CAACK,cAAc,CAAC,CAAC;MACtC,MAAMC,GAAG,GAAG,EAAE;MACd,MAAMC,MAAM,GAAG,CAAC,CAACP,EAAE,CAACQ,eAAe,CAAC,CAAC,CAACD,MAAM;MAC5C,KAAK,MAAME,IAAI,IAAI1B,KAAK,EAAE;QACtB,IAAIwB,MAAM,IAAIE,IAAI,IAAI,IAAI,EAAE;UACxBH,GAAG,CAACI,IAAI,CAAC,IAAI,CAACzB,MAAM,CAACmB,UAAU,EAAEK,IAAI,CAAC,CAAC;QAC3C;MACJ;MACA,OAAOH,GAAG;IACd,CAAC,MACI,IAAIN,EAAE,CAACW,WAAW,CAAC,CAAC,IAAIZ,QAAQ,EAAE;MACnC,MAAMa,SAAS,GAAGZ,EAAE,CAACK,cAAc,CAAC,CAAC;MACrC,MAAMC,GAAG,GAAG,CAAC,CAAC;MACd,MAAMC,MAAM,GAAG,CAAC,CAACP,EAAE,CAACQ,eAAe,CAAC,CAAC,CAACD,MAAM;MAC5C,KAAK,MAAM,CAACM,EAAE,EAAEC,EAAE,CAAC,IAAIC,MAAM,CAACC,OAAO,CAACjC,KAAK,CAAC,EAAE;QAC1C,IAAIwB,MAAM,IAAIO,EAAE,IAAI,IAAI,EAAE;UACtBR,GAAG,CAACO,EAAE,CAAC,GAAG,IAAI,CAAC5B,MAAM,CAAC2B,SAAS,EAAEE,EAAE,CAAC;QACxC;MACJ;MACA,OAAOR,GAAG;IACd,CAAC,MACI,IAAIN,EAAE,CAACT,cAAc,CAAC,CAAC,IAAIQ,QAAQ,EAAE;MACtC,MAAMO,GAAG,GAAG,CAAC,CAAC;MACd,KAAK,MAAM,CAACW,UAAU,EAAEC,YAAY,CAAC,IAAIlB,EAAE,CAACmB,cAAc,CAAC,CAAC,EAAE;QAC1D,MAAMC,SAAS,GAAG,IAAI,CAAC3C,QAAQ,CAAC4C,QAAQ,GAAGH,YAAY,CAACV,eAAe,CAAC,CAAC,CAACa,QAAQ,IAAIJ,UAAU,GAAGA,UAAU;QAC7G,MAAMK,iBAAiB,GAAG,IAAI,CAACrC,MAAM,CAACiC,YAAY,EAAEnC,KAAK,CAACkC,UAAU,CAAC,EAAEjB,EAAE,CAAC;QAC1E,IAAIsB,iBAAiB,KAAKhC,SAAS,EAAE;UACjCgB,GAAG,CAACc,SAAS,CAAC,GAAGE,iBAAiB;QACtC;MACJ;MACA,OAAOhB,GAAG;IACd;IACA,IAAIvB,KAAK,KAAK,IAAI,IAAIe,SAAS,EAAEP,cAAc,CAAC,CAAC,EAAE;MAC/C,OAAO,KAAK,CAAC;IACjB;IACA,IAAKS,EAAE,CAACuB,YAAY,CAAC,CAAC,KAAKxC,KAAK,YAAYyC,UAAU,IAAI,OAAOzC,KAAK,KAAK,QAAQ,CAAC,IAC/EiB,EAAE,CAACR,gBAAgB,CAAC,CAAC,IAAIT,KAAK,YAAYyC,UAAW,EAAE;MACxD,IAAIxB,EAAE,KAAK,IAAI,CAACrB,UAAU,EAAE;QACxB,OAAOI,KAAK;MAChB;MACA,OAAO,CAAC,IAAI,CAAC0C,YAAY,EAAEC,aAAa,IAAIrD,QAAQ,EAAEU,KAAK,CAAC;IAChE;IACA,IAAI,CAACiB,EAAE,CAAC2B,iBAAiB,CAAC,CAAC,IAAI3B,EAAE,CAACR,gBAAgB,CAAC,CAAC,KAAKT,KAAK,YAAY6C,IAAI,EAAE;MAC5E,MAAMC,MAAM,GAAG9D,wBAAwB,CAACiC,EAAE,EAAE,IAAI,CAACvB,QAAQ,CAAC;MAC1D,QAAQoD,MAAM;QACV,KAAK,CAAC;UACF,OAAO9C,KAAK,CAAC+C,WAAW,CAAC,CAAC,CAACC,OAAO,CAAC,OAAO,EAAE,GAAG,CAAC;QACpD,KAAK,CAAC;UACF,OAAO9D,eAAe,CAACc,KAAK,CAAC;QACjC,KAAK,CAAC;UACF,OAAOA,KAAK,CAACiD,OAAO,CAAC,CAAC,GAAG,IAAI;QACjC;UACIC,OAAO,CAACC,IAAI,CAAC,+CAA+C,EAAEnD,KAAK,CAAC;UACpE,OAAOA,KAAK,CAACiD,OAAO,CAAC,CAAC,GAAG,IAAI;MACrC;IACJ;IACA,IAAIhC,EAAE,CAACmC,eAAe,CAAC,CAAC,IAAI,OAAOpD,KAAK,KAAK,QAAQ,EAAE;MACnD,IAAIqD,IAAI,CAACC,GAAG,CAACtD,KAAK,CAAC,KAAKuD,QAAQ,IAAIC,KAAK,CAACxD,KAAK,CAAC,EAAE;QAC9C,OAAOyD,MAAM,CAACzD,KAAK,CAAC;MACxB;IACJ;IACA,IAAIiB,EAAE,CAACyC,cAAc,CAAC,CAAC,EAAE;MACrB,IAAI,OAAO1D,KAAK,KAAK,WAAW,IAAIiB,EAAE,CAAC0C,kBAAkB,CAAC,CAAC,EAAE;QACzD,OAAOxE,wBAAwB,CAAC,CAAC;MACrC;MACA,MAAMyE,SAAS,GAAG3C,EAAE,CAACQ,eAAe,CAAC,CAAC,CAACmC,SAAS;MAChD,IAAI5D,KAAK,IAAI,IAAI,IAAI4D,SAAS,EAAE;QAC5B,MAAMC,MAAM,GAAGD,SAAS,KAAK,kBAAkB,IAAIA,SAAS,CAACE,QAAQ,CAAC,OAAO,CAAC;QAC9E,IAAID,MAAM,EAAE;UACR,OAAOzE,cAAc,CAAC2E,IAAI,CAAC/D,KAAK,CAAC;QACrC;MACJ;IACJ;IACA,IAAIiB,EAAE,CAACR,gBAAgB,CAAC,CAAC,EAAE;MACvB,IAAIO,QAAQ,EAAE;QACV,MAAMO,GAAG,GAAGJ,KAAK,CAACC,OAAO,CAACpB,KAAK,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QAC1C,KAAK,MAAM,CAACgE,CAAC,EAAEC,CAAC,CAAC,IAAIjC,MAAM,CAACC,OAAO,CAACjC,KAAK,CAAC,EAAE;UACxC,IAAIiE,CAAC,YAAY5E,YAAY,EAAE;YAC3BkC,GAAG,CAACyC,CAAC,CAAC,GAAGC,CAAC;UACd,CAAC,MACI;YACD1C,GAAG,CAACyC,CAAC,CAAC,GAAG,IAAI,CAAC9D,MAAM,CAACe,EAAE,EAAEgD,CAAC,CAAC;UAC/B;QACJ;QACA,OAAO1C,GAAG;MACd,CAAC,MACI;QACD,OAAO2C,eAAe,CAAClE,KAAK,CAAC;MACjC;IACJ;IACA,OAAOA,KAAK;EAChB;AACJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}